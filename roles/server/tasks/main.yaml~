---
- name: Update packages
  shell:
    cmd: apt update -y
  tags:
    - update

      #- name: Ser timezone
      #  community.general.timezone:
      #    name: Europe/Minsk
      #  tags:
      #    - timezone

- name: Install packages
  sudo: yes
  apt:
    name: "{{ apt_packages }}"
    state: latest
    update_cache: yes
  tags:
    - install_packages 

- name: Add the sudo user
  user:
    name: "{{ sudo_user }}"
    shell: /bin/bash
    password: "{{s_pass}}"
    groups: sudo
  tags: 
    - add_user

- name: Add user www to sudoers
  shell:
    cmd: echo " "{{ sudo_user }}"  ALL=(ALL) NOPASSWD:ALL" > /etc/sudoers.d/ "{{ sudo_user }}"
  tags: 
    - add_user

- name: Find groups
  shell: cat /etc/passwd
  register: groups

- name: Create group docker
  group:
    name: docker
    state: present
  when: groups.stdout.find('docker') != -1
  
- name: Add user to group
  user:
    name: "{{ sudo_user }}"
    groups: docker
    append: yes
  when: groups.stdout.find('docker') != -1

- name: Add foldef for code
  sudo: yes
  file: 
    path: ~/code
    state: directory
    owner: "{{ sudo_user }}"
  tags:
    - add_folder_code

- name: Add foldef for jenkins
  sudo: yes
  file: 
    path: ~/jenkins
    state: directory
    owner: "{{ sudo_user }}"
  tags:
    - jenkins_add_folder

- name: Find alias
  shell: cat /home/"{{ sudo_user }}"/.bashrc
  register: alias
  tags: 
    - test

- name: Add any alias
  shell:
    cmd: echo "alias cls='clear'" >> /home/"{{ sudo_user }}"/.bashrc
  when: alias.stdout.find('clear') != -1
  tags:
    - test

- name: Debus messages
  when: alias.stdout.find('clear') != 1
  debug: msg="Alias already exist"
  tags:
    - test



