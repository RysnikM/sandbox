<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3DOtchet</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="assets/css/mdb.min.css">
    <link rel="stylesheet" href="assets/css/datatables.min.css">
</head>

<body>
    <ol class="breadcrumb" id="breadcrumbsID" style="background-color:#ffffff;padding-bottom:0px;">
        <li class="breadcrumb-item"><a href="/start"><span>Главная</span></a></li>
        <li class="breadcrumb-item"><a href="/start/repairs"><span>Ремонтные работы</span></a></li>
        <li class="breadcrumb-item active"><span>Отчеты</span></li>
    </ol>
    <div>

        <div class="tab-content">

            <div class="tab-pane active" role="tabpanel" id="tab-2">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-12" id="otchetTableLost"><table class="table table-bordered table-sm table-hover text-center VibroTable" cellspacing="0" width="100%">
  
	<thead>
    <tr>
       <th class="th-sm">ID записи</th>
		<th class="th-sm">Тип ремонта</th>
		<th class="th-sm">оборудование</th>
      <th class="th-sm">Узел</th>
         <th class="th-sm">Причина ремонта</th>
             <th class="th-sm">Название детали вышедшей из строя</th>
               <th class="th-sm">Заказной код детали вышедшей из строя</th>
                          <th class="th-sm">Название детали установленной взамен</th>
               <th class="th-sm">Заказной код детали установленной взамен</th>
      <th class="th-sm">Задействовано людей</th>
      <th class="th-sm">Дата и время начала ремонтных работ</th>
		<th class="th-sm">Дата и время окончания ремонтных работ</th>
      <th class="th-sm">Продолжительность ремонтных работ (ч)</th>
		<th class="th-sm">Описание</th>
		<th class="th-sm">Комментарий</th>
		<th class="th-sm">Пользователь</th>
		<th id="TimeInt" class="th-sm">Дата заполнения</th>
    <th id="doit" class="th-sm">Действия</th>
	      </tr>
  </thead>
  <tbody id="spisok">
	 </tbody>
  <tfoot>
    <tr>
    <th class="th-sm">ID записи</th>
		<th class="th-sm">Тип ремонта</th>
		<th class="th-sm">оборудование</th>
      <th class="th-sm">Узел</th>
           <th class="th-sm">Причина ремонта</th>
            <th class="th-sm">Название детали вышедшей из строя</th>
               <th class="th-sm">Заказной код детали вышедшей из строя</th>
                          <th class="th-sm">Название детали установленной взамен</th>
               <th class="th-sm">Заказной код детали установленной взамен</th>
      <th class="th-sm">Задействовано людей</th>
      <th class="th-sm">Дата и время начала ремонтных работ</th>
		<th class="th-sm">Дата и время окончания ремонтных работ</th>
      <th class="th-sm">Продолжительность ремонтных работ (ч)</th>
		<th class="th-sm">Описание</th>
		<th class="th-sm">Комментарий</th>
		<th class="th-sm">Пользователь</th>
		<th class="th-sm">Дата заполнения</th>
    <th class="th-sm">Действия</th>
      </tr>
  </tfoot>
</table></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container-fluid" id="padBot">
        <div style="padding-bottom:84px;"></div>
    </div>
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/js/tooltip.js"></script>
    <script src="assets/js/moment-with-locales.js"></script>
    <script src="assets/js/btn.js"></script>
    <script src="assets/js/datatables.min.js"></script>
    <script src="assets/js/all.min.js"></script>
</body>

</html>




<script>
    //передача данных из php в html
       var name = '<?php  echo($resJson); php?>';
       
     name=name.replace(/\r?\n/g, " ");
     //  name = name.replace(/[^A-Za-z 0-9 \.,\?""!@#\$%\^&\*\(\)-_=\+;:<>\/\\\|\}\{\[\]`~]*/g, '');
    var fortable = JSON.parse(name);
 var arrName  = '<?php  echo($nameA); php?>';
console.log(arrName );
     arrName  = JSON.parse(arrName );


//вывод таблицы
var spisokUsers="";
$(fortable).each(function(a,b){
var prod = (b.endTime - b.startTime)/3600;
if(b.typeOfRepair==1){var type="Плановый ремонт"}
	if(b.typeOfRepair==2){var type="Аварийный ремонт"}
 spisokUsers=spisokUsers+" <tr id='rem_"+b.id+"'><td>"+b.id+"</td><td>"+type+"</td><td>"+b.oborudovanie+"</td><td>"+b.uzel+"</td><td>"+b.prichina+"</td>\
      <td>"+b.detailNameDestroy+"</td><td>"+b.codeDetailDestroy+"</td><td>"+b.datailNameNew+"</td><td>"+b.codeDetailNew+"</td><td>"+b.colMan+"</td><td>"+moment(b.startTime*1000).format('DD:MM:YYYY H:mm:ss')+"</td><td>"+moment(b.endTime*1000).format('DD:MM:YYYY H:mm:ss')+"</td><td>"+prod+"</td>\
      <td>"+b.opisanie+"</td>\
    <td>"+b.comment+"</td>\
          <td>"+b.user+"  "+b.usersurname+"</td>\
    <td>"+moment(b.time*1000).format('YYYY-MM-DD H:mm:ss')+"</td>\
    <td><button id='"+b.id+"' data-id='up' type='button'  class='btn btn-primary btn-sm m-0 btn-rounded'>Редактировать</button></td>\
    </tr>";    
});
$("#spisok").html(spisokUsers);
$("#TimeInt").trigger("click");
$("button[data-id=up]").click(function(){
     if(arrName.level>9){
location.href="/start/repairs/repairsNow/index.php?redact=1&id="+this.id;
}else{
    alert("Нет прав доступа");
}
});
</script>
