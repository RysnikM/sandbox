<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>edit_table_vibrationPoint</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    
    <link rel="stylesheet" href="assets/css/mdb.min.css">
    <link rel="stylesheet" href="assets/css/datatables.min.css">
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="stylesheet" href="assets/css/table-css.css">
</head>

<body>

    <ol class="breadcrumb" id="breadcrumbsID" style="background-color:#ffffff;padding-bottom:0px;">
        <li class="breadcrumb-item"><a href="index.html"><span>Главная</span></a></li>
        <li class="breadcrumb-item"><a href="index.html"><span>Параметры</span></a></li>
        <li class="breadcrumb-item active"><span>Изменение точек контроля вибрации<br></span></li>
    </ol>
    <div class="container-fluid">
        <div class="row">
            <div class="col-12" id="otchetTableLost"><div class="wrapper-modal-editor">

   <div class="row d-flex justify-content-center modalWrapper">
    <div class="modal fade addNewInputs" id="modalAdd" tabindex="-1" role="dialog" aria-labelledby="modalAdd"
      aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header text-center">
            <h4 class="modal-title w-100 font-weight-bold text-primary ml-5">Добавить новую точку контроля вибрации</h4>
            <button type="button" class="close text-primary" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div id="addpoint" class="modal-body mx-3">
            <div class="md-form mb-5">
              <input type="text" id="name" class="form-control validate">
              <label data-error="измените" data-success="принято" for="name">Название</label>
            </div>
			  
		  
            <div class="md-form mb-5">
              <input list="equipmentList" type="text" id="group_id" class="form-control validate">
              <label data-error="измените" data-success="принято" for="group_id">Оборудование</label>
            </div>	
            
<datalist id="equipmentList">
    <option selected="selected"   disabled>Выберите оборудование</option>
  <?php foreach($resultgroup as $val){ ?>
 <option value="<?php echo($val['id']); ?>">
  <?php echo($val['name']); ?></option><?php } ?>
</datalist>
			  
			  <div class="md-form mb-5">
              <input type="number" id="granica_mess" class="form-control validate">
              <label data-error="измените" data-success="принято" for="granica_mess">Граница предупреждения</label>
            </div>

			  <div class="md-form mb-5">
              <input type="number" id="granica_alarm" class="form-control validate">
              <label data-error="измените" data-success="принято" for="granica_alarm">Граница аварии</label>
            </div>
		            <div class="md-form mb-5">
              <input type="text" id="tablename" class="form-control validate" pattern="[a-zA-Z0-9]">
              <label data-error="только цифры и буквы латинского алфавита" data-success="принято" for="tablename">Название таблицы</label>
            </div>
        
           
          </div>
          <div class="modal-footer d-flex justify-content-center buttonAddFormWrapper">
            <button id="addpointbutton" class="btn btn-outline-primary btn-block buttonAdd" data-dismiss="modal">Добавить
              <i class="fas fa-paper-plane-o ml-1"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="text-center">
      <a href="" class="btn btn-info btn-rounded btn-sm" data-toggle="modal" data-target="#modalAdd">Добавить<i
          class="fas fa-plus-square ml-1"></i></a>
    </div>

    <div class="modal fade modalEditClass" id="modalEdit" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header text-center">
            <h4 class="modal-title w-100 font-weight-bold text-secondary ml-5">Изменить</h4>
            <button type="button" class="close text-secondary" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div id="redactpoint" class="modal-body mx-3">
                       <div class="md-form mb-5">
              <input type="text" id="name" class="form-control validate">
              <label data-error="измените" data-success="принято" for="name">Название</label>
            </div>
        






























  <div class="md-form mb-5">          
<select  class="browser-default custom-select" id="group_id">
    <option selected="selected"   disabled>Выберите оборудование</option>
  <?php foreach($resultgroup as $val){ ?>
 <option value-gr="<?php echo($val['id']); ?>" value="<?php echo($val['id']); ?>">
  <?php echo($val['name']); ?></option><?php } ?>
</select>
         </div>  
        <div class="md-form mb-5">
              <input type="number" id="granica_mess" class="form-control validate">
              <label data-error="измените" data-success="принято" for="granica_mess">Граница предупреждения</label>
            </div>
        <div class="md-form mb-5">
              <input type="number" id="granica_alarm" class="form-control validate">
              <label data-error="измените" data-success="принято" for="granica_alarm">Граница аварии</label>
            </div>
<!--                 <div class="md-form mb-5">
              <input type="text" id="tablename" class="form-control validate" pattern="[a-zA-Z0-9]">
              <label data-error="только цифры и буквы латинского алфавита" data-success="принято" for="tablename">Название таблицы</label>
            </div> -->
		   </div>
          <div class="modal-footer d-flex justify-content-center editInsideWrapper">
            <button id="redactpointbutton" class="btn btn-outline-secondary btn-block editInside" data-dismiss="modal">Изменить
              <i class="fas fa-paper-plane-o ml-1"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="text-center buttonEditWrapper">
      <button id="redactbut" class="btn btn-info btn-rounded btn-sm buttonEdit" data-toggle="modal" data-target="#modalEdit"
        disabled>Изменить<i class="fas fa-pencil-square-o ml-1"></i></a>
    </div>






























    <div class="modal fade" id="modalDelete" tabindex="-1" role="dialog" aria-labelledby="modalDelete"
      aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header text-center">
            <h4 class="modal-title w-100 font-weight-bold ml-5 text-danger">Удалить</h4>
            <button type="button" class="close text-danger" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body mx-3">
            <p class="text-center h4">Вы уверены что хотите удалить выбранную точку контроля вибрации?</p>

          </div>
          <div class="modal-footer d-flex justify-content-center deleteButtonsWrapper">
            <button type="button" class="btn btn-danger btnYesClass" id="del" data-dismiss="modal">Да</button>
            <button type="button" class="btn btn-primary btnNoClass" id="btnNo" data-dismiss="modal">Нет</button>
          </div>
        </div>
      </div>
    </div>

    <div class="text-center">
      <button class="btn btn-danger btn-sm btn-rounded buttonDelete" data-toggle="modal" disabled data-target="#modalDelete"
        disabled>Удалить<i class="fas fa-times ml-1"></i></a>
    </div>
  </div>

<table id="pointVibrationTable" class="table table-bordered table-hover table-sm text-center" cellspacing="0" width="100%">
  <thead>
    <tr>
      <th class="th-sm">Название</th>
	  <th class="th-sm">Граница предупреждения</th>
		<th class="th-sm">Граница аварии</th>
      <th class="th-sm">Название таблицы</th>
         <th class="th-sm">Оборудование</th>
         <th class="th-sm">Внес изменения</th>
    	        <th class="th-sm">Дата изменения</th>
    </tr>
  </thead>
  <tbody id="listusers">

   
  </tbody>
	<tfoot>
		<tr>
   	<th>Название</th>
	  <th>Граница предупреждения</th>
			<th>Граница аварии</th>
      <th>Название таблицы</th>
            <th>Оборудование</th>
          <th class="th-sm">Внес изменения</th>
                <th class="th-sm">Дата изменения</th>  
			</tr>
      </tfoot>
</table>
	
	
	</div>
        </div>
    </div>
    <div class="container-fluid" id="padBot">
        <div style="padding-bottom:84px;"></div>
    </div>
  
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/js/mdb.min.js"></script>
    <script src="assets/js/tooltip.js"></script>
    <script src="assets/js/all.js"></script>
    <script src="assets/js/moment-with-locales.js"></script>
    <script src="assets/js/datatables.min.js"></script>
    <script src="assets/js/table-pointVibration.js"></script>
</body>

</html>

<script>
    //передача данных из php в html
       var name = '<?php  echo($resJson); php?>';
        var spis = '<?php  echo($resultJson); php?>';
    var arrName = JSON.parse(name);
    var arrSpis = JSON.parse(spis);
    $('#NameUser').html(arrName.name);
      $('#PositionUser').html(arrName.position);



//вывод таблицы
var spisokUsers="";
$(arrSpis).each(function(a,b){
 spisokUsers=spisokUsers+"     <tr value='"+b.tablename+"' id='point_"+b.id+"_"+b.parentid+"_"+b.tablename+"'>\
      <td>"+b.name+"</td>\
      <td>"+b.granica_mess+"</td>\
    <td>"+b.granica_alarm+"</td>\
      <td>"+b.tablename+"</td>\
            <td>"+b.groupname+"</td>\
            <td>"+b.userchange+"</td>\
            <td>"+moment(b.timechange*1000).format('lll')+"</td>\
    </tr>";    
});
$("#listusers").html(spisokUsers);

//добавление пользователя
$("#addpointbutton").click(function(){

$("#addpoint>.md-form>input").each(function(a,v){
    if($(this).attr("id")=="name" || $(this).attr("id")=="group_id" || $(this).attr("id")=="code"){
if($(this).val().trim()==''){ alert("одно из полей обязательного ввода пусто"); exit();}
}
});
if($("#addpoint>.md-form>#group_id").val()==undefined){ alert("одно из полей обязательного ввода пусто"); exit();}
$(arrSpis).each(function(a,b){
 if(b.tablename==$("#addpoint>.md-form>#tablename").val()){
  alert("Таблица с таким именем уже существует"); exit();
 }   
 if(b.name==$("#addpoint>.md-form>#name").val()  && b.parentid==$("#addpoint>.md-form>#parentid").val()){
  alert("Точка с таким именем уже существует"); exit();
 } 
});
var zapros="";
$("#addpoint>.md-form>input").each(function(a,v){
zapros=zapros+"&"+$(this).attr("id")+"="+$(this).val();
});
zapros=zapros+"&parentid="+$("#addpoint>.md-form>#group_id").val();
  $.ajax({
    type: "GET",
    url: "index.php?addobor=1"+zapros,
  success: function(msg){
    alert(msg);
location.href="index.php";
  }
});
});

$("#redactbut").click(function(){
      var id = $(".tr-color-selected").attr("id");
 var arr=id.split("_");

var idd=arr[1];
var parentid=arr[2];
$("#redactpoint>.md-form>#group_id").val(parentid);
});

$("#redactpointbutton").click(function(){
      var id = $(".tr-color-selected").attr("id");
 var arr=id.split("_");
var idd=arr[1];
var parentid=arr[2];
var tab_d=arr[3];
$("#redactpoint>.md-form>#group_id").val(parentid);
$("#redactpoint>.md-form>input").each(function(a,v){
    if($(this).attr("id")=="name" || $(this).attr("id")=="group_id" || $(this).attr("id")=="code"){
if($(this).val().trim()==''){ alert("одно из полей обязательного ввода пусто"); exit();}
}
});
if($("#redactpoint>.md-form>#group_id").val()==undefined){ alert("одно из полей обязательного ввода пусто"); exit();}
$(arrSpis).each(function(a,b){
 if(b.tablename==$("#redactpoint>.md-form>#tablename").val()){
  alert("Таблица с таким именем уже существует"); exit();
 }   
 if(b.name==$("#redactpoint>.md-form>#name").val() && b.id!=idd && b.parentid==$("#redactpoint>.md-form>#parentid").val()){
  alert("Точка с таким именем уже существует"); exit();
 } 
});
var zapros="";
$("#redactpoint>.md-form>input").each(function(a,v){
zapros=zapros+"&"+$(this).attr("id")+"="+$(this).val();
});
zapros=zapros+"&parentid="+$("#redactpoint>.md-form>#group_id").val();
zapros=zapros+"&tablename_del="+tab_d;
zapros+="&id="+idd;
alert(zapros);
  $.ajax({
    type: "GET",
    url: "index.php?updateobor=1"+zapros,
  success: function(msg){
    alert(msg);
location.href="index.php";
  }
});
});



$("#del").click(function(){
   
      var id = $(".tr-color-selected").attr("id");
 var arr=id.split("_");
var idd=arr[1];

    var tabn=$(".tr-color-selected").attr("value");
    $.ajax({
    type: "GET",
    url: "index.php?iddel="+idd+"&tablename="+tabn,
  success: function(msg){
    alert(msg);
location.href="index.php";
  }
});

});
</script>