<!DOCTYPE html>
<html lang="ru">
<html>
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!--<link rel="stylesheet" href="css/Navigation-with-Button.css"> -->
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.bundle.min.js"></script>
   
</head>
<body>

<div class="team-clean">
    <nav id="croshki" aria-label="breadcrumb"></nav>
<!-- Button trigger modal -->
<button  type="button" class="btn btn-primary" data-toggle="modal" id="openmod" data-target="#exampleModal">
  Добавить оборудование
</button>
<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Заполните поля формы</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div id="adduserpole" class="modal-body">
        <input type="text" id="name"/> - введите название <br>
<p><select class="browser-default custom-select"  id="group_id1">
    <option selected disabled>Выберите группу</option>
  <?php foreach($resultgroup as $val){ ?>  <option value="<?php echo($val['id']); ?>"><?php echo($val['name']); ?></option><?php } ?>
   </select></p>

        <input type="text" id="code"/> - введите спец код <br>
        <input type="text" id="tablename"/><div id="tablename1"> - введите название табилцы</div> <br>
        <input type="text" style="display: none;" id="id"/>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Отмена</button>
        <button type="button" id="adduser" class="btn btn-primary">Добавить</button>
        <button type="button" id="updateobor" style="display: none;" class="btn btn-primary">Изменить</button>
      </div>
    </div>
  </div>
</div>

       <div class="list-group" id="spsiokUser"></div>
        </div>
</div>


    <script type="text/javascript">
    	function drawStatusPerepheria(number){
    		for (var i = 1; i < number+1; i++) {
    			$("#IndicPeref").append('<svg width="31" height="25" ><rect id="IPph'+i+'" x="5" y="5" width="20" height="15" rx="2"fill="yellowgreen" stroke="green" stroke-width="1"><title>Состояние блока переферии '+i+'</title><rect></svg>')
    		}
     	}
     	drawStatusPerepheria(12);
		var arrayStatus=[1,0,1,0,1,0,1,0,1,0,1,0,1];

    	function changeStatus(arrStatus,clGreen,brGreen,clRed,brRed) {
    		if (arrStatus[0]) {
    			$("#IPLC").attr('fill', clGreen);
    			$("#IPLC").attr('stroke', brGreen);
    		} else{
    			$("#IPLC").attr('fill', clRed);
    			$("#IPLC").attr('stroke', brRed);
    		}
    	
    		for (var i = 1; (i < arrStatus.length) ; i++) {
    		if (arrStatus[i]) {
    			$("#IPph"+i).attr('fill', clGreen);
    			$("#IPph"+i).attr('stroke', brGreen);
    		} else {
    			$("#IPph"+i).attr('fill', clRed);
    			$("#IPph"+i).attr('stroke', brRed);
    		}
    		}
    		}
    	changeStatus(arrayStatus,'yellowgreen','green','orangered','red');

    </script>

<script>
	 $(document).on('click', '.btn-add', function(event) {
	 event.preventDefault();

	 var field = $(this).closest('.form-group');
	 var field_new = field.clone();

	 $(this)
	 .toggleClass('btn-success')
	 .toggleClass('btn-add')
	 .toggleClass('btn-danger')
	 .toggleClass('btn-remove')
	 .html('✖');

	 field_new.find('input').val('');
	 field_new.insertAfter(field);
	 });

	 $(document).on('click', '.btn-remove', function(event) {
	 event.preventDefault();
	 $(this).closest('.form-group').remove();
	 });
</script>
<script>
    //передача данных из php в html
       var name = '<?php  echo($resJson); php?>';
        var spis = '<?php  echo($resultJson); php?>';
         var groups = '<?php  echo($groupJson); php?>';
    var arrName = JSON.parse(name);
    var arrSpis = JSON.parse(spis);
    $('#NameUser').html(arrName.name);
      $('#PositionUser').html(arrName.position);


//вывод хлбеных крошек на странице
var croshki="<ol class='breadcrumb'>";
$(arrName.path).each(function(a,b){
 croshki=croshki+" "+"<li class='breadcrumb-item'><a href='"+b.path+"'>"+b.name+"</a></li>";
});
croshki=croshki+"</ol>"
$("#croshki").html(croshki);

//вывод списка
var spisokUsers="<ul class='list-group'>";
$(arrSpis).each(function(a,b){
 spisokUsers=spisokUsers+"<br>"+" <a  class='list-group-item list-group-item-action' id='"+b.id+"'href='#' ><span class='badge badge-primary badge-pill'>"+b.id+" </span>  имя - "+b.name+" группа - "+b.group_id+" наименование груупы - "+b.groupname+" код еденицы - "+b.code+" название табилцы - "+b.tablename+"</a><button class='del' value='"+b.tablename+"' id='"+b.id+"'>Удалить</button><button data-toggle='modal' data-target='#exampleModal'  class='redact' id='"+b.id+"'>Редактировать</button>";    
});
spisokUsers=spisokUsers+"</ul>";
$("#spsiokUser").html(spisokUsers);


      // логаут пользователя
    function logout(){
$.ajax({
    type: "GET",
    url: "/phpmodule/sessuser.php?name=logout",
  success: function(msg){
location.href="/index.php";
  }
 });  }



//добавление пользователя
$("#adduser").click(function(){
$("#adduserpole>input").each(function(a,v){
    if($(this).attr("id")=="name" || $(this).attr("id")=="group_id1" || $(this).attr("id")=="code"){
if($(this).val().trim()==''){ alert("одно из полей обязательного ввода пусто"); exit();}
}
});
if($("#group_id1").val()==undefined){ alert("одно из полей обязательного ввода пусто"); exit();}
$(arrSpis).each(function(a,b){
 if(b.tablename==$("#tablename").val()){
  alert("Таблица с таким именем уже существует"); exit();
 }   
 if(b.name==$("#name").val() && b.id!=$("#id").val()  && b.code==$("#group_id1").val()){
  alert("Оборудование с таким именем уже существует"); exit();
 } 
    if(b.group_id==$("#code").val() && b.id!=$("#id").val()) {
  alert("Код занят"); exit();
 } 
});
var zapros="";
$("#adduserpole>input").each(function(a,v){
zapros=zapros+"&"+$(this).attr("id")+"="+$(this).val();
});
zapros=zapros+"&group_id="+$("#group_id1").val();
  $.ajax({
    type: "GET",
    url: "index.php?addobor=1"+zapros,
  success: function(msg){
    alert(msg);
location.href="index.php";
  }
});
});
function exit(){return false;}
// редактирование оборудования
$("#updateobor").click(function(){
$("#adduserpole>input").each(function(a,v){
    if($(this).attr("id")=="name" ||  $(this).attr("id")=="code"){
if($(this).val().trim()==''){ alert("одно из полей обязательного ввода пусто"); exit();}
}
});
if($("#group_id1").val()==undefined){ alert("одно из полей обязательного ввода пусто"); exit();}
$(arrSpis).each(function(a,b){
 if(b.tablename==$("#tablename").val() && b.id!=$("#id").val() ){
  alert("Таблица с таким именем уже существует"); exit();
 }   
 if(b.name==$("#name").val() && b.id!=$("#id").val()  && b.code==$("#group_id1").val()){
  alert("Оборудование с таким именем уже существует"); exit();
 } 
   if(b.group_id==$("#code").val() && b.id!=$("#id").val()) {
  alert("Код занят"); exit();
 } 
});
var zapros="";
$("#adduserpole>input").each(function(a,v){
zapros=zapros+"&"+$(this).attr("id")+"="+$(this).val();
zapros=zapros+"&group_id="+$("#group_id1").val();
});
  $.ajax({
    type: "GET",
    url: "index.php?updateobor=1"+zapros,
  success: function(msg){
    alert(msg);
location.href="index.php";
  }
});
});

//переход на редактирование страницы
$(".redact").click(function(){
 var id = $(this).attr("id");
 var arr;
 $("#adduser").css("display","none");
  $("#updateobor").css("display","block");
  //tablename
   $("#tablename1").css("display","none");
    $("#tablename").css("display","none");
$(arrSpis).each(function(a,b){
if(b.id==id){
 arr=b;
} 
});
$("#name").val(arr.name);
$("#code").val(arr.group_id);
$("#group_id1").val(arr.code);
$("#tablename").val(arr.tablename);
$("#id").val(arr.id);
// location.href="userredact/index.php?id="+id;
 });


$(".del").click(function(){
    if(!confirm("Вы уверены что хотите удалить оборудование. Операция не обратима!")){return false;}else{
    var idd=$(this).attr("id");
    var tabn=$(this).attr("value");
    $.ajax({
    type: "GET",
    url: "index.php?iddel="+idd+"&tablename="+tabn,
  success: function(msg){
    alert(msg);
location.href="index.php";
  }
});
}
});

$("#openmod").click(function(){
   $("#tablename").css("display","block");
    $("#tablename1").css("display","block");
});
</script>
</body>
</html>