<!DOCTYPE html>
<html lang="ru">
<html>
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!--<link rel="stylesheet" href="css/Navigation-with-Button.css"> -->
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.bundle.min.js"></script>
   
</head>
<body>

<div class="team-clean">
    <nav id="croshki" aria-label="breadcrumb"></nav>
<!-- Button trigger modal -->
<button  type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
  Добавить пользователя
</button>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Заполните поля формы</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div id="adduserpole" class="modal-body">
        <input type="text" id="name"/> - введите имя 
        <input type="text" id="surname"/> - введите фамилию
        <input type="text" id="sex"/> - введите пол
        <input type="text" id="position"/> - введите должность
        <input type="text" id="age"/> - введите возраст
        <input type="text" id="nikname"/> - введите логин
        <input type="password" id="pass"/>  - введите пароль
        <input type="password" id="pass_reapeat"/>  - введите пароль повторно
        <input type="text" id="levelAccess"/> - введите уровень доступа
        <input type="email" id="email"/> - введите  email
        <input type="text" style="display: none;" id="id"/>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Отмена</button>
        <button type="button" id="adduser" class="btn btn-primary">Добавить</button>
        <button type="button" id="updateobor" style="display: none;" class="btn btn-primary">Изменить</button>
      </div>
    </div>
  </div>
</div>

       <div class="list-group" id="spsiokUser"></div>
        </div>
</div>
<!-- <br>
<div class="container-fluid" style="margin-top: 20px;">
	<div class="row justify-content-left">
 <div class="col-3">
 <form>
 <div class="form-group">
 <div class="form-group input-group">
 <select class="form-control">
 <option>Станок 1</option>
 <option>Пункт 2</option>
 <option>Пункт 3</option>
 </select>
 <span class="input-group-btn">
 <button type="button" class="btn btn-success btn-add">✚</button>
 </span>
 </div>
 </div> 
 </form>
 </div>


	</div>

</div> -->


    <script type="text/javascript">
    	function drawStatusPerepheria(number){
    		for (var i = 1; i < number+1; i++) {
    			$("#IndicPeref").append('<svg width="31" height="25" ><rect id="IPph'+i+'" x="5" y="5" width="20" height="15" rx="2"fill="yellowgreen" stroke="green" stroke-width="1"><title>Состояние блока переферии '+i+'</title><rect></svg>')
    		}
     	}
     	drawStatusPerepheria(12);
		var arrayStatus=[1,0,1,0,1,0,1,0,1,0,1,0,1];

    	function changeStatus(arrStatus,clGreen,brGreen,clRed,brRed) {
    		if (arrStatus[0]) {
    			$("#IPLC").attr('fill', clGreen);
    			$("#IPLC").attr('stroke', brGreen);
    		} else{
    			$("#IPLC").attr('fill', clRed);
    			$("#IPLC").attr('stroke', brRed);
    		}
    	
    		for (var i = 1; (i < arrStatus.length) ; i++) {
    		if (arrStatus[i]) {
    			$("#IPph"+i).attr('fill', clGreen);
    			$("#IPph"+i).attr('stroke', brGreen);
    		} else {
    			$("#IPph"+i).attr('fill', clRed);
    			$("#IPph"+i).attr('stroke', brRed);
    		}
    		}
    		}
    	changeStatus(arrayStatus,'yellowgreen','green','orangered','red');

    </script>

<script>
	 $(document).on('click', '.btn-add', function(event) {
	 event.preventDefault();

	 var field = $(this).closest('.form-group');
	 var field_new = field.clone();

	 $(this)
	 .toggleClass('btn-success')
	 .toggleClass('btn-add')
	 .toggleClass('btn-danger')
	 .toggleClass('btn-remove')
	 .html('✖');

	 field_new.find('input').val('');
	 field_new.insertAfter(field);
	 });

	 $(document).on('click', '.btn-remove', function(event) {
	 event.preventDefault();
	 $(this).closest('.form-group').remove();
	 });
</script>
<script>
    //передача данных из php в html
       var name = '<?php  echo($resJson); php?>';
        var spis = '<?php  echo($resultJson); php?>';
    var arrName = JSON.parse(name);
    var arrSpis = JSON.parse(spis);
    $('#NameUser').html(arrName.name);
      $('#PositionUser').html(arrName.position);


//вывод хлбеных крошек на странице
var croshki="<ol class='breadcrumb'>";
$(arrName.path).each(function(a,b){
 croshki=croshki+" "+"<li class='breadcrumb-item'><a href='"+b.path+"'>"+b.name+"</a></li>";
});
croshki=croshki+"</ol>"
$("#croshki").html(croshki);

//вывод хлбеных крошек на странице
var spisokUsers="<ul class='list-group'>";
$(arrSpis).each(function(a,b){
 spisokUsers=spisokUsers+"<br>"+" <a  class='list-group-item list-group-item-action' id='"+b.id+"'href='#' ><span class='badge badge-primary badge-pill'>"+b.id+" </span>  имя - "+b.name+" фамилия - "+b.surname+" должность - "+b.position+" уровень доступа - "+b.levelAccess+" телефон - "+b.telephone+"</a><button class='del' id='"+b.id+"'>Удалить</button><button class='redact' data-toggle='modal' data-target='#exampleModal' id='"+b.id+"'>Редактировать</button>";    
});
spisokUsers=spisokUsers+"</ul>";
$("#spsiokUser").html(spisokUsers);


      // логаут пользователя
    function logout(){
$.ajax({
    type: "GET",
    url: "/phpmodule/sessuser.php?name=logout",
  success: function(msg){
location.href="/index.php";
  }
 });  }



//добавление пользователя
$("#adduser").click(function(){
$("#adduserpole>input").each(function(a,v){
    if($(this).attr("id")=="name" || $(this).attr("id")=="surname" || $(this).attr("id")=="pass" || $(this).attr("id")=="pass_reapeat" || $(this).attr("id")=="nikname" || $(this).attr("id")=="levelAccess"){
if($(this).val().trim()==''){ alert("одно из полей обязательного ввода пусто"); return false;}
}
});
$("#adduserpole>input").each(function(a,v){
if($("#pass").val()!=$("#pass_reapeat").val()){alert("Повторный ввод пароля не верен"); $("#pass_reapeat").focus();  return false;}
});
var zapros="";
$("#adduserpole>input").each(function(a,v){
zapros=zapros+"&"+$(this).attr("id")+"="+$(this).val();
});
  $.ajax({
    type: "GET",
    url: "index.php?adduser=1"+zapros,
  success: function(msg){
    alert(msg);
location.href="index.php";
  }
});
});



// редактирование пользователя
$("#updateobor").click(function(){
$("#adduserpole>input").each(function(a,v){
    if($(this).attr("id")=="name" || $(this).attr("id")=="surname" || $(this).attr("id")=="pass" || $(this).attr("id")=="pass_reapeat" || $(this).attr("id")=="nikname" || $(this).attr("id")=="levelAccess"){
if($(this).val().trim()==''){ alert("одно из полей обязательного ввода пусто"); return false;}
}
});
$("#adduserpole>input").each(function(a,v){
if($("#pass").val()!=$("#pass_reapeat").val()){alert("Повторный ввод пароля не верен"); $("#pass_reapeat").focus();  return false;}
});

var zapros="";
$("#adduserpole>input").each(function(a,v){
zapros=zapros+"&"+$(this).attr("id")+"="+$(this).val();
});
  $.ajax({
    type: "GET",
    url: "index.php?updateobor=1"+zapros,
  success: function(msg){
    alert(msg);
location.href="index.php";
  }
});
});

//переход на редактирование страницы
$(".redact").click(function(){
 var id = $(this).attr("id");
 var arr;
 $("#adduser").css("display","none");
  $("#updateobor").css("display","block");
$(arrSpis).each(function(a,b){
if(b.id==id){
 arr=b;
} 
});
$("#name").val(arr.name);
$("#surname").val(arr.surname);
$("#nikname").val(arr.nikname);
$("#levelAccess").val(arr.levelAccess);
$("#sex").val(arr.sex);
$("#position").val(arr.position);
$("#email").val(arr.email);
$("#age").val(arr.age);
$("#pass").val(arr.pass);
$("#pass_reapeat").val(arr.pass);
$("#id").val(arr.id);
// location.href="userredact/index.php?id="+id;
 });



$(".del").click(function(){
    if(!confirm("Вы уверены что хотите удалить пользователя. Операция не обратима!")){return false;}else{
    var idd=$(this).attr("id");
    $.ajax({
    type: "GET",
    url: "index.php?iddel="+idd,
  success: function(msg){
    alert(msg);
location.href="index.php";
  }
});
}
});


</script>
</body>
</html>