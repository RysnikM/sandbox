<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>edit_table_user</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    
    <link rel="stylesheet" href="assets/css/mdb.min.css">
    <link rel="stylesheet" href="assets/css/datatables.min.css">
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="stylesheet" href="assets/css/table-css.css">
</head>

<body>

    <ol class="breadcrumb" id="breadcrumbsID" style="background-color:#ffffff;padding-bottom:0px;">
        <li class="breadcrumb-item"><a href="/start"><span>Главная</span></a></li>
        <li class="breadcrumb-item"><a href="/start/parametrs"><span>Параметры</span></a></li>
        <li class="breadcrumb-item active"><span>Редактирование таблицы пользователей</span></li>
    </ol>
    <div class="container-fluid">
        <div class="row">
            <div class="col-12" id="otchetTableLost"><div class="wrapper-modal-editor">

   <div class="row d-flex justify-content-center modalWrapper">
    <div class="modal fade addNewInputs" id="modalAdd" tabindex="-1" role="dialog" aria-labelledby="modalAdd"
      aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header text-center">
            <h4 class="modal-title w-100 font-weight-bold text-primary ml-5">Добавить нового пользователя</h4>
            <button type="button" class="close text-primary" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div id="adduserpole" class="modal-body mx-3">
            <div class="md-form mb-5">
              <input type="text" id="name" class="form-control validate">
              <label data-error="измените" data-success="принято" for="inputName">Имя</label>
            </div>
			<div class="md-form mb-5">
              <input type="text" id="surname" class="form-control validate">
              <label data-error="измените" data-success="принято" for="inputName">Фамилия</label>
            </div>
			  <div class="md-form mb-5">
              <input type="text" id="inputPatronymic" class="form-control validate">
              <label data-error="измените" data-success="принято" for="inputPatronymic">Отчество</label>
            </div>
		            <div class="md-form mb-5">
              <input type="text" id="position" class="form-control validate">
              <label data-error="измените" data-success="принято" for="inputPositionInput">Должность</label>
            </div>
        
           
            <div class="md-form mb-5">
              <input type="text" id="nikname" class="form-control validate">
              <label data-error="измените" data-success="принято" for="inputLogin">Логин</label>
            </div>
			<div class="md-form mb-5">
              <input type="text" id="pass" class="form-control validate" minlength="8">
				<label data-error="измените" data-success="принято" for="inputPassword">Пароль, минимум 8 символов</label>
            </div>

			  <div  class="md-form mb-5">
              <input type="text" id="levelAccess" class="form-control validate">
				<label data-error="измените" data-success="принято" for="inputLevelAccess">Уровень доступа</label>
            </div>
    

          </div>
          <div class="modal-footer d-flex justify-content-center buttonAddFormWrapper">
            <button id="adduser" class="btn btn-outline-primary btn-block buttonAdd" data-dismiss="modal">Добавить
              <i class="fas fa-paper-plane-o ml-1"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="text-center">
      <a href="" class="btn btn-info btn-rounded btn-sm" data-toggle="modal" data-target="#modalAdd">Добавить<i
          class="fas fa-plus-square ml-1"></i></a>
    </div>

    <div class="modal fade modalEditClass" id="modalEdit" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header text-center">
            <h4 id="redact" class="modal-title w-100 font-weight-bold text-secondary ml-5">Изменить</h4>
            <button type="button" class="close text-secondary" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div id="editInputs" class="modal-body mx-3">
            <div class="md-form mb-5">
              <input type="text" id="name" class="form-control validate">
              <label data-error="измените" data-success="принято" for="inputName">Имя</label>
            </div>
      <div class="md-form mb-5">
              <input type="text" id="surname" class="form-control validate">
              <label data-error="измените" data-success="принято" for="inputName">Фамилия</label>
            </div>
        <div class="md-form mb-5">
              <input type="text" id="inputPatronymic" class="form-control validate">
              <label data-error="измените" data-success="принято" for="inputPatronymic">Отчество</label>
            </div>
                <div class="md-form mb-5">
              <input type="text" id="position" class="form-control validate">
              <label data-error="измените" data-success="принято" for="inputPositionInput">Должность</label>
            </div>
        
           
            <div class="md-form mb-5">
              <input type="text" id="nikname" class="form-control validate">
              <label data-error="измените" data-success="принято" for="inputLogin">Логин</label>
            </div>
      <div class="md-form mb-5">
              <input type="text" id="pass" class="form-control validate" minlength="8">
        <label data-error="измените" data-success="принято" for="inputPassword">Пароль, минимум 8 символов</label>
            </div>

        <div  class="md-form mb-5">
              <input type="text" id="levelAccess" class="form-control validate">
        <label data-error="измените" data-success="принято" for="inputLevelAccess">Уровень доступа</label>
            </div>

          </div>
          <div class="modal-footer d-flex justify-content-center editInsideWrapper">
            <button id="edituser" class="btn btn-outline-secondary btn-block editInside" data-dismiss="modal">Изменить
              <i class="fas fa-paper-plane-o ml-1"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="text-center buttonEditWrapper">
      <button class="btn btn-info btn-rounded btn-sm buttonEdit" data-toggle="modal" data-target="#modalEdit"
        disabled>Изменить<i class="fas fa-pencil-square-o ml-1"></i></a>
    </div>

    <div class="modal fade" id="modalDelete" tabindex="-1" role="dialog" aria-labelledby="modalDelete"
      aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header text-center">
            <h4  class="modal-title w-100 font-weight-bold ml-5 text-danger">Удалить</h4>
            <button type="button" class="close text-danger" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body mx-3">
            <p class="text-center h4">Вы уверены что хотите удалить выбранного пользователя?</p>

          </div>
          <div class="modal-footer d-flex justify-content-center deleteButtonsWrapper">
            <button type="button" class="btn btn-danger btnYesClass" id="delituser" data-dismiss="modal">Да</button>
            <button type="button" class="btn btn-primary btnNoClass" id="btnNo" data-dismiss="modal">Нет</button>
          </div>
        </div>
      </div>
    </div>

    <div class="text-center">
      <button class="btn btn-danger btn-sm btn-rounded buttonDelete" data-toggle="modal" disabled data-target="#modalDelete"
        disabled>Удалить<i class="fas fa-times ml-1"></i></a>
    </div>
  </div>

<table id="userTable" class="table table-bordered table-hover table-sm text-center" cellspacing="0" width="100%">
  <thead>
    <tr>
      <th class="th-sm">Имя</th>
      <th class="th-sm">Фамилий</th>
	  <th class="th-sm">Отчество</th>
      
      <th class="th-sm">Должность</th>
      
      <th class="th-sm">Логин</th>
		<th class="th-sm">Пароль</th>
	  <th class="th-sm">Уровень доступа</th>
	  
    </tr>
  </thead>
  <tbody id="listusers">
  
  </tbody>
   	<th>Имя</th>
      <th>Фамилий</th>
	  <th>Отчество</th>
      
      <th>Должность</th>
      
      <th>Логин</th>
	  <th>Пароль</th>
	  <th>Уровень доступа</th>
	 
</table></div>
        </div>
    </div>
    <div class="container-fluid" id="padBot">
        <div style="padding-bottom:84px;"></div>
    </div>
   
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/js/mdb.min.js"></script>
    <script src="assets/js/tooltip.js"></script>
    <script src="assets/js/all.js"></script>
    <script src="assets/js/moment-with-locales.js"></script>
    <script src="assets/js/datatables.min.js"></script>
    <script src="assets/js/table-user.js"></script>
</body>

</html>




<script>
    //передача данных из php в html
       var name = '<?php  echo($resJson); php?>';
        var spis = '<?php  echo($resultJson); php?>';
    var arrName = JSON.parse(name);
    var arrSpis = JSON.parse(spis);
    $('#NameUser').html(arrName.name);
      $('#PositionUser').html(arrName.position);



//вывод таблицы
var spisokUsers="";
$(arrSpis).each(function(a,b){
 spisokUsers=spisokUsers+" <tr id='user_"+b.id+"'><td>"+b.name+"</td>\
      <td>"+b.surname+"</td>\
      <td></td>\
      <td>"+b.position+"</td>\
    <td>"+b.nikname+"</td>\
    <td>"+"******"+"</td>\
      <td>"+b.levelAccess+"</td>\
    </tr>";    
});
$("#listusers").html(spisokUsers);




//добавление пользователя
$("#adduser").click(function(){
$("#adduserpole>.md-form>input").each(function(a,v){
    if($(this).attr("id")=="name" || $(this).attr("id")=="surname" || $(this).attr("id")=="pass" || $(this).attr("id")=="pass_reapeat" || $(this).attr("id")=="nikname" || $(this).attr("id")=="levelAccess"){
if($(this).val().trim()==''){ alert("одно из полей обязательного ввода пусто"); return false;}
}
});
$("#adduserpole>.md-form>input").each(function(a,v){
if($("#pass").val()!=$("#pass_reapeat").val()){alert("Повторный ввод пароля не верен"); $("#pass_reapeat").focus();  return false;}
});
var zapros="";
$("#adduserpole>.md-form>input").each(function(a,v){
zapros=zapros+"&"+$(this).attr("id")+"="+$(this).val();
});
alert(zapros);
  $.ajax({
    type: "GET",
    url: "index.php?adduser=1"+zapros,
  success: function(msg){
    alert(msg);
location.href="index.php";
  }
});
});



// редактирование пользователя
$("#edituser").click(function(){
   var id = $(".tr-color-selected").attr("id");
 var arr=id.split("_");
var ids=arr[1];

$("#editInputs>.md-form>input").each(function(a,v){
    if($(this).attr("id")=="name" || $(this).attr("id")=="surname" || $(this).attr("id")=="pass" || $(this).attr("id")=="pass_reapeat" || $(this).attr("id")=="nikname" || $(this).attr("id")=="levelAccess"){
if($(this).val().trim()==''){ alert("одно из полей обязательного ввода пусто"); return false;}
}
});
$("#editInputs>.md-form>input").each(function(a,v){
if($("#pass").val()!=$("#pass_reapeat").val()){alert("Повторный ввод пароля не верен"); $("#pass_reapeat").focus();  return false;}
});

var zapros="";
$("#editInputs>.md-form>input").each(function(a,v){
zapros=zapros+"&"+$(this).attr("id")+"="+$(this).val();
});
zapros+="&id="+ids;
  $.ajax({
    type: "GET",
    url: "index.php?updateobor=1"+zapros,
  success: function(msg){
    alert(msg);
location.href="index.php";
  }
});
});





$("#delituser").click(function(){

      var id = $(".tr-color-selected").attr("id");
 var arr=id.split("_");
var idd=arr[1];

    $.ajax({
    type: "GET",
    url: "index.php?iddel="+idd,
  success: function(msg){
    alert(msg);
location.href="index.php";
  }
});

});


</script>