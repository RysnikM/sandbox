<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3dscaner</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="assets/css/mdb.min.css">
    <link rel="stylesheet" href="assets/css/datatables.min.css">
</head>

<body>
    <ol class="breadcrumb" id="breadcrumbsID" style="background-color:#ffffff;padding-bottom:0px;">
        <li class="breadcrumb-item"><a href="/start"><span>Главная</span></a></li>
        <li class="breadcrumb-item"><a href="/start/3d"><span>3D сканер</span></a></li>
        <li class="breadcrumb-item active"><span>Онлайн</span></li>
    </ol>
    <div class="container-fluid">
        <div class="row">
            <div class="col-12" id="otchetTableLost">
                <h3 class="text-center">Последние отсканированные бревна</h3><table class="table table-bordered table-sm text-center VibroTable" cellspacing="0" width="100%">
  
	<thead>
    <tr>
      <th class="th-sm">ID бревна</th>
      <th class="th-sm">Входной диаметр, см</th>
      <th class="th-sm">Выходной диаметр, см</th>
      <th class="th-sm">Средний диаметр, см</th>
      <th class="th-sm">Длина бревна, м</th>
      <th class="th-sm">Кривизна, %</th>
		<th class="th-sm">Общий объём, м<sup>3</sup></th>
      <th class="th-sm">Полезный объем, м<sup>3</sup></th>
	  <th class="th-sm">Время окончания сканирования</th>	
      </tr>
  </thead>
  <tbody>
    <?php foreach($resWood as $k=>$val){ ?>
    <tr>
      <td><?php echo($val['id']); ?></td>
      <td><?php echo(round($val['inputRad'],2)); ?></td>
      <td><?php echo(round($val['outputRad'],2)); ?></td>
      <td><?php echo(round($val['avrRad'],2)); ?></td>
            <td>1.65</td>
          <td><?php echo(round($val['curvature']*100,2)); ?></td>  
      <td><?php echo(round($val['volume'],2)); ?></td>
		<td><?php echo(round($val['usefulVolume'],2)); ?></td>
      <td><?php echo(date("c",$val['timeStamp'])); ?></td>
    </tr>
    <?php } ?>
    </table></div>
        </div>
    </div>
    <div class="container-fluid d-flex flex-grow-1 justify-content-center align-items-center align-content-center" id="3d-chart"><div id="container" style="width: 100%;height: 500px;"></div>
</div>
    <div class="container-fluid" id="padBot">
        <div style="padding-bottom:84px;"></div>
    </div>
<script type="text/javascript">
           var dat = '<?php  echo($resJson); ?>';
    var data = JSON.parse(dat);
           var tabl = '<?php  echo($tabl); ?>';
    var tabl = JSON.parse(tabl);
    
    console.log(tabl[2]);
    var len=data.length;
//alert(len);
</script>


    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/js/tooltip.js"></script>
    <script src="assets/js/moment-with-locales.js"></script>
    <script src="assets/js/highcharts.js"></script>
    <script src="assets/js/highcharts-3d.js"></script>
    <script src="assets/js/all.min.js"></script>
    <script src="assets/js/datatables.min.js"></script>
    <script src="assets/js/3dbrevno.js"></script>
</body>

</html>

<script type="text/javascript">
$( document ).ready(function() {
	var contsrez=0;
	console.log(data);
	$.each(data,function(a,b){
	DrawBrevno(b.radius,b.xCentre,b.yCentre);
	if(contsrez!=0){
		var srRadius=(parseFloat(data[contsrez-1].radius)+parseFloat(data[contsrez].radius))/2;
		var srX=(parseFloat(data[contsrez-1].xCentre)+parseFloat(data[contsrez].xCentre))/2;
		var srY=(parseFloat(data[contsrez-1].yCentre)+parseFloat(data[contsrez].yCentre))/2;
		console.log(srRadius+"--"+srX+"--"+srY);
		DrawBrevno(srRadius,srX,srY);

	}
	contsrez++;
	});

});

function updateWood(){
$.ajax({
    type: "GET",
    url: "index.php?update=1",
  success: function(msg){
      var msg = JSON.parse(msg);
console.log(msg);
if(msg.id!=tabl[2].id){

  setTimeout(function(){document.location.reload(true);}, 800);
}
  
}
});
    }



$(document).ready(function () {
            setInterval(function() {
  updateWood();
}, 2000);
});


</script>

